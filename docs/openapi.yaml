openapi: 3.0.3
info:
  title: 꿀템장바구니 API
  description: |
    오프라인 매장 추천 상품 정보를 제공하는 API입니다.
    유튜브 크리에이터들이 추천하는 다이소, 코스트코, 이케아 등
    오프라인 매장 상품 정보를 수집하여 제공합니다.
  version: 1.0.0
  contact:
    name: Shopping Helper Support
  license:
    name: MIT

servers:
  - url: /api
    description: Local development

tags:
  - name: Products
    description: 상품 조회 API
  - name: Stats
    description: 통계 API
  - name: Catalog
    description: 매장 카탈로그 API

paths:
  /products:
    get:
      tags:
        - Products
      summary: 상품 목록 조회
      description: 필터, 정렬, 검색을 지원하는 상품 목록을 반환합니다.
      operationId: getProducts
      parameters:
        - name: store
          in: query
          description: 매장 필터 (all, daiso, costco, ikea, oliveyoung, traders, cu, gs25, seveneleven, emart24)
          schema:
            type: string
            default: all
            enum:
              - all
              - daiso
              - costco
              - ikea
              - oliveyoung
              - traders
              - cu
              - gs25
              - seveneleven
              - emart24
        - name: category
          in: query
          description: 카테고리 필터
          schema:
            type: string
        - name: search
          in: query
          description: 검색어 (상품명, 품번, 채널명, 키워드)
          schema:
            type: string
        - name: sort
          in: query
          description: 정렬 기준
          schema:
            type: string
            default: popular
            enum:
              - popular
              - newest
              - price_low
              - price_high
        - name: limit
          in: query
          description: 페이지당 상품 수
          schema:
            type: integer
            default: 100
            minimum: 1
            maximum: 500
        - name: offset
          in: query
          description: 페이지 오프셋
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: includeHidden
          in: query
          description: 숨김 상품 포함 여부
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductListResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: 데이터베이스 연결 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stats:
    get:
      tags:
        - Stats
      summary: 통계 조회
      description: 전체 통계 정보를 반환합니다.
      operationId: getStats
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatsResponse'
        '500':
          description: 서버 에러
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /catalog/{store}:
    get:
      tags:
        - Catalog
      summary: 매장별 카탈로그 조회
      description: 특정 매장의 카탈로그 데이터를 반환합니다.
      operationId: getCatalog
      parameters:
        - name: store
          in: path
          required: true
          description: 매장 코드
          schema:
            type: string
            enum:
              - daiso
              - costco
              - ikea
              - oliveyoung
              - traders
              - coupang
              - convenience
        - name: limit
          in: query
          description: 반환할 최대 상품 수
          schema:
            type: integer
            default: 100
        - name: offset
          in: query
          description: 시작 위치
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CatalogResponse'
        '400':
          description: 잘못된 매장 코드
        '500':
          description: 서버 에러

components:
  schemas:
    Product:
      type: object
      properties:
        id:
          type: integer
          description: 상품 ID
        video_id:
          type: string
          description: 출처 YouTube 영상 ID
        name:
          type: string
          description: 상품명
        price:
          type: integer
          nullable: true
          description: 가격 (원)
        category:
          type: string
          description: 카테고리
        reason:
          type: string
          description: 추천 이유
        timestamp_sec:
          type: integer
          nullable: true
          description: 영상 내 타임스탬프 (초)
        timestamp_text:
          type: string
          nullable: true
          description: 타임스탬프 포맷 (mm:ss)
        keywords:
          type: array
          items:
            type: string
          description: 관련 키워드
        store_key:
          type: string
          description: 매장 코드
        store_name:
          type: string
          description: 매장명
        official_code:
          type: string
          nullable: true
          description: 공식 품번
        official_name:
          type: string
          nullable: true
          description: 공식 상품명
        official_price:
          type: integer
          nullable: true
          description: 공식 가격
        official_image_url:
          type: string
          nullable: true
          description: 상품 이미지 URL
        official_product_url:
          type: string
          nullable: true
          description: 상품 상세페이지 URL
        is_matched:
          type: boolean
          description: 공식 상품 매칭 여부
        is_approved:
          type: boolean
          description: 승인 여부
        source_view_count:
          type: integer
          description: 출처 영상 조회수
        created_at:
          type: string
          format: date-time
          description: 등록일
        video_title:
          type: string
          nullable: true
          description: 출처 영상 제목
        channel_title:
          type: string
          nullable: true
          description: 채널명
        thumbnail_url:
          type: string
          description: 영상 썸네일 URL

    ProductListResponse:
      type: object
      properties:
        products:
          type: array
          items:
            $ref: '#/components/schemas/Product'
        total:
          type: integer
          description: 전체 상품 수
        limit:
          type: integer
          description: 요청한 limit
        offset:
          type: integer
          description: 요청한 offset
        hasMore:
          type: boolean
          description: 추가 데이터 존재 여부

    StatsResponse:
      type: object
      properties:
        total_videos:
          type: integer
          description: 전체 영상 수
        total_products:
          type: integer
          description: 전체 상품 수
        approved_products:
          type: integer
          description: 승인된 상품 수
        matched_products:
          type: integer
          description: 매칭된 상품 수
        pending_products:
          type: integer
          description: 대기 중 상품 수
        by_store:
          type: object
          additionalProperties:
            type: integer
          description: 매장별 상품 수
        by_category:
          type: object
          additionalProperties:
            type: integer
          description: 카테고리별 상품 수
        catalog_counts:
          type: object
          additionalProperties:
            type: integer
          description: 카탈로그별 상품 수
        updated_at:
          type: string
          format: date-time
          description: 통계 업데이트 시간

    CatalogResponse:
      type: object
      properties:
        store:
          type: string
          description: 매장 코드
        items:
          type: array
          items:
            $ref: '#/components/schemas/CatalogItem'
        total:
          type: integer
          description: 전체 카탈로그 수

    CatalogItem:
      type: object
      properties:
        id:
          type: integer
        product_id:
          type: string
          description: 상품 ID
        name:
          type: string
          description: 상품명
        price:
          type: integer
          description: 가격
        image_url:
          type: string
          nullable: true
        product_url:
          type: string
          nullable: true
        category:
          type: string
          nullable: true

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: 에러 메시지
        products:
          type: array
          items: {}
          description: 빈 배열 (fallback)
